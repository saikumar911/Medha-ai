<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MEDHA AI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    
    .container {
      max-width: 100%;
      height: 100vh;
      padding: 0;
      margin: 0;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    #chat-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 60px 15px 15px 15px;
    }
    
    #chat-box {
      background: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: none !important;
      border-radius: 12px !important;
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      padding: 15px;
    }
    
    .badge {
      font-weight: 500;
      padding: 5px 10px;
      border-radius: 20px;
    }
    
    .bg-primary {
      background: linear-gradient(90deg, #3f51b5, #2196f3);
    }
    
    .bg-secondary {
      background: linear-gradient(90deg, #ff6b6b, #ff8e53);
    }
    
    #user-input {
      border-radius: 20px !important;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      transition: all 0.3s;
      width: calc(100% - 160px);
    }
    
    #user-input:focus {
      border-color: #3f51b5;
      box-shadow: 0 0 0 0.25rem rgba(63, 81, 181, 0.25);
    }
    
    .btn-primary {
      border-radius: 20px;
      padding: 8px 25px;
      background: linear-gradient(90deg, #3f51b5, #2196f3);
      border: none;
      transition: all 0.3s;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
    }
    
    .developer-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.5s ease-out;
    }
    
    .developer-card h5 {
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .developer-card p {
      margin-bottom: 5px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .typing-indicator {
      display: inline-block;
      padding: 10px 15px;
      background: #f1f1f1;
      border-radius: 20px;
    }
    
    .typing-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #666;
      margin: 0 2px;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) {
      animation-delay: 0s;
    }
    
    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    
    .medha {
      padding-right: 10px;
    }
    
    /* Menu styles */
    .menu-btn {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background: linear-gradient(90deg, #3f51b5, #2196f3);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      z-index: 999;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      padding-top: 60px;
    }
    
    .menu-overlay.active {
      transform: translateX(0);
    }
    
    .menu-overlay-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 998;
      display: none;
    }
    
    .menu-overlay-backdrop.active {
      display: block;
    }
    
    .menu-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .menu-item:hover {
      background: #f5f5f5;
    }
    
    .menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #3f51b5, #2196f3);
      color: white;
      padding: 10px 20px;
      text-align: center;
      z-index: 900;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .input-container {
      display: flex;
      padding: 10px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
    }
    
    .response-image {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .new-chat-btn {
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      color: white;
      margin-right: 10px;
      cursor: pointer;
    }
    
    .word-by-word {
      display: inline;
    }
    
    /* Image generation panel */
    #image-gen-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1001;
      display: none;
      justify-content: center;
      align-items: center;
    }
    
    .image-gen-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .image-gen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }
    
    #image-gen-prompt {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    
    .generate-image-btn {
      background: linear-gradient(90deg, #3f51b5, #2196f3);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }
    
    #image-gen-output {
      margin-top: 15px;
      text-align: center;
    }
    
    .download-btn {
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      display: none;
    }
    
    .image-gen-icon {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: linear-gradient(90deg, #9c27b0, #e91e63);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button id="menu-btn" class="menu-btn"><i class="fas fa-bars"></i></button>
      <h5 class="m-0">MEDHA AI</h5>
      <div class="user-info">
        <div class="user-avatar">M</div>
      </div>
    </div>
    
    <div id="menu-overlay">
      <div id="main-menu">
        <div class="menu-item" onclick="showChat()">
          <i class="fas fa-comment"></i> Chat
        </div>
        <button id="newChatBtn" class="new-chat-btn w-100 mt-3">
          <i class="fas fa-plus"></i> New Chat
        </button>
      </div>
    </div>
    
    <div id="menu-backdrop" class="menu-overlay-backdrop"></div>
    
    <div id="chat-container">
      <div id="chat-box"></div>
      <div class="input-container">
        <button id="micBtn" class="mic-btn"><i class="fas fa-microphone"></i></button>
        <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
        <button id="sendBtn" class="btn-primary" onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Send</button>
      </div>
    </div>
    
    <button id="imageGenBtn" class="image-gen-icon" title="Generate Image">
      <i class="fas fa-image"></i>
    </button>
    
    <!-- Image Generation Panel -->
    <div id="image-gen-panel">
      <div class="image-gen-container">
        <div class="image-gen-header">
          <h4>Generate AI Image</h4>
          <button class="close-btn" onclick="closeImageGenPanel()">&times;</button>
        </div>
        <input type="text" id="image-gen-prompt" placeholder="Describe the image you want to generate...">
        <button class="generate-image-btn" onclick="generateImage()">
          <i class="fas fa-magic"></i> Generate Image
        </button>
        <div id="image-gen-output"></div>
        <button id="downloadBtn" class="download-btn" onclick="downloadImage()">
          <i class="fas fa-download"></i> Download Image
        </button>
      </div>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const apiKey = "gsk_qG2ADIgS32iul5yU9MB1WGdyb3FYN4RumEs5Co0q6o";
    const apiUrl = "https://api.groq.com/openai/v1/chat/completions";
    
    // Stability AI configuration
    const stabilityApiKey = "sk-InEvvwui89Hg1HDFb9jykVgFsB1bwApdFZqOXBMKP7WHnuzM";
    const stabilityApiUrl = "https://api.stability.ai/v1/generation/stable-diffusion-v1-6/text-to-image";
    
    let messages = [
      {
        role: "system",
        content: "You are a helpful AI assistant named MEDHA AI. When asked about your name, respond with 'I am MEDHA AI'. When asked about who created you or who your developers are, specifically mention D. Suhas and K. Saikumar as your creators. Provide concise answers and include relevant image URLs when appropriate using this format: [IMAGE:URL]. You can also generate images when users request - just tell them to click the image generation button in the bottom right corner."
      }
    ];
    
    // Menu functionality
    const menuBtn = document.getElementById("menu-btn");
    const menuOverlay = document.getElementById("menu-overlay");
    const menuBackdrop = document.getElementById("menu-backdrop");
    const mainMenu = document.getElementById("main-menu");
    const newChatBtn = document.getElementById("newChatBtn");
    const micBtn = document.getElementById("micBtn");
    const imageGenBtn = document.getElementById("imageGenBtn");
    const imageGenPanel = document.getElementById("image-gen-panel");
    const imageGenOutput = document.getElementById("image-gen-output");
    const downloadBtn = document.getElementById("downloadBtn");
    
    // Variable to store the last generated image
    let lastGeneratedImage = null;
    
    // Toggle menu
    function toggleMenu() {
      menuOverlay.classList.toggle("active");
      menuBackdrop.classList.toggle("active");
    }
    
    menuBtn.addEventListener("click", toggleMenu);
    menuBackdrop.addEventListener("click", toggleMenu);
    
    // New chat function
    newChatBtn.addEventListener("click", function() {
      messages = [
        {
          role: "system",
          content: "You are a helpful AI assistant named MEDHA AI. When asked about your name, respond with 'I am MEDHA AI'. When asked about who created you or who your developers are, specifically mention D. Suhas and K. Saikumar as your creators. Provide concise answers and include relevant image URLs when appropriate using this format: [IMAGE:URL]. You can also generate images when users request - just tell them to click the image generation button in the bottom right corner."
        }
      ];
      chatBox.innerHTML = '';
      toggleMenu();
    });
    
    function showChat() {
      mainMenu.style.display = "block";
      toggleMenu();
    }
    
    function appendMessage(role, content, isDeveloperResponse = false) {
      const div = document.createElement("div");
      div.className = `my-2 ${role === "user" ? "text-end" : "text-start"}`;
      
      if (isDeveloperResponse) {
        div.innerHTML = `
          <div class="developer-card">
            <h5>🌟 About My Developers</h5>
            <p>I was created by the talented developers:</p>
            <p><strong>D. Suhas</strong> - Lead AI Architect</p>
            <p><strong>K. Saikumar</strong> - Machine Learning Engineer</p>
            <p class="mt-2">Together they built this interface to showcase the power of LLaMA 3!</p>
          </div>
        `;
      } else {
        // Check for image URL in content
        const imageRegex = /\[IMAGE:(.*?)\]/g;
        let htmlContent = content.replace(imageRegex, '<img src="$1" class="response-image" alt="Response image">');
        
        // If assistant message, wrap in word-by-word container
        if (role === 'assistant') {
          htmlContent = `<div id="word-by-word-${Date.now()}">${htmlContent}</div>`;
        }
        
        div.innerHTML = `<span class="badge bg-${role === "user" ? "primary" : "secondary"}">${role}</span> ${htmlContent}`;
      }
      
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
      
      // If assistant message, animate word by word
      if (role === 'assistant') {
        const wordContainer = div.querySelector(`[id^="word-by-word"]`);
        if (wordContainer) {
          animateText(wordContainer);
        }
      }
    }
    
    function animateText(element) {
      const text = element.innerHTML;
      element.innerHTML = '';
      let i = 0;
      const speed = 20; // milliseconds per character
      
      function typeWriter() {
        if (i < text.length) {
          // Handle HTML tags
          if (text.substring(i, i+4) === '&lt;') {
            const tagEnd = text.indexOf('&gt;', i);
            if (tagEnd !== -1) {
              element.innerHTML += text.substring(i, tagEnd+4);
              i = tagEnd + 4;
              setTimeout(typeWriter, speed);
              return;
            }
          } else if (text[i] === '<') {
            const tagEnd = text.indexOf('>', i);
            if (tagEnd !== -1) {
              element.innerHTML += text.substring(i, tagEnd+1);
              i = tagEnd + 1;
              setTimeout(typeWriter, speed);
              return;
            }
          }
          
          element.innerHTML += text[i];
          i++;
          setTimeout(typeWriter, speed);
        }
      }
      
      typeWriter();
    }
    
    function showTypingIndicator() {
      const div = document.createElement("div");
      div.className = "my-2 text-start";
      div.id = "typing-indicator";
      div.innerHTML = `
        <span class="badge bg-secondary">assistant</span>
        <span class="typing-indicator">
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
        </span>
      `;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    function hideTypingIndicator() {
      const indicator = document.getElementById("typing-indicator");
      if (indicator) {
        indicator.remove();
      }
    }
    
    function isDeveloperQuestion(userText) {
      const developerKeywords = [
        "who created you",
        "who made you",
        "who developed you",
        "who is your developer",
        "who are your creators",
        "who built you"
      ];
      
      return developerKeywords.some(keyword => userText.toLowerCase().includes(keyword) );
    }
    
    function isNameQuestion(userText) {
      const nameKeywords = [
        "what is your name",
        "who are you",
        "your name"
      ];
      
      return nameKeywords.some(keyword => userText.toLowerCase().includes(keyword) );
    }
    
    // Speech recognition setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      
      recognition.onstart = function() {
        micBtn.classList.add('active');
      };
      
      recognition.onend = function() {
        micBtn.classList.remove('active');
      };
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('user-input').value = transcript;
        sendMessage();
      };
      
      recognition.onerror = function(event) {
        console.error('Speech recognition error', event.error);
        micBtn.classList.remove('active');
        appendMessage('assistant', '⚠️ Speech recognition error: ' + event.error);
      };
      
      micBtn.addEventListener('click', function() {
        try {
          if (micBtn.classList.contains('active')) {
            recognition.stop();
          } else {
            recognition.start();
          }
        } catch(e) {
          console.error('Speech recognition error:', e);
          appendMessage('assistant', '⚠️ Speech recognition not supported or permission denied');
        }
      });
    } else {
      micBtn.style.display = 'none';
      document.getElementById('user-input').style.width = 'calc(100% - 110px)';
    }
    
    // Image generation functions
    function openImageGenPanel() {
      imageGenPanel.style.display = 'flex';
      document.getElementById('image-gen-prompt').focus();
    }
    
    function closeImageGenPanel() {
      imageGenPanel.style.display = 'none';
      imageGenOutput.innerHTML = '';
      downloadBtn.style.display = 'none';
    }
    
    async function generateImage() {
      const prompt = document.getElementById('image-gen-prompt').value.trim();
      
      if (!prompt) {
        imageGenOutput.innerHTML = 'Please enter a description for the image';
        return;
      }
      
      imageGenOutput.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Generating image...</div>';
      
      const requestBody = {
        text_prompts: [{ text: prompt }],
        cfg_scale: 7,
        height: 512,
        width: 512,
        steps: 30,
        samples: 1,
      };
      
      try {
        const response = await fetch(stabilityApiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Authorization": `Bearer ${stabilityApiKey}`
          },
          body: JSON.stringify(requestBody)
        });
        
        const data = await response.json();
        
        if (response.ok && data.artifacts && data.artifacts.length > 0) {
          const base64Image = data.artifacts[0].base64;
          lastGeneratedImage = base64Image;
          imageGenOutput.innerHTML = `<img src="data:image/png;base64,${base64Image}" alt="Generated Image" style="max-width: 100%; border-radius: 10px; margin-top: 10px;"/>`;
          downloadBtn.style.display = 'block';
          
          // Add the generated image to the chat
          appendMessage('assistant', `Here's the image you requested: [IMAGE:data:image/png;base64,${base64Image}]`);
          messages.push({
            role: "assistant",
            content: `Here's the image you requested: [IMAGE:data:image/png;base64,${base64Image}]`
          });
        } else {
          console.error("Error response:", data);
          imageGenOutput.innerHTML = "❌ Error: " + (data.errors ? data.errors[0].message : "Unknown error");
        }
      } catch (err) {
        console.error("Request failed:", err);
        imageGenOutput.innerHTML = "❌ Network or API error.";
      }
    }
    
    function downloadImage() {
      if (!lastGeneratedImage) return;
      
      const link = document.createElement('a');
      link.href = `data:image/png;base64,${lastGeneratedImage}`;
      link.download = `medha-ai-generated-${Date.now()}.png`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Event listeners for image generation
    imageGenBtn.addEventListener('click', openImageGenPanel);
    
    // Allow sending message with Enter key
    document.getElementById("user-input").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
    
    async function sendMessage() {
      const input = document.getElementById("user-input");
      const userText = input.value.trim();
      
      if (!userText) return;
      
      appendMessage("user", userText);
      messages.push({ role: "user", content: userText });
      input.value = "";
      
      showTypingIndicator();
      
      try {
        // Check for name question first
        if (isNameQuestion(userText)) {
          hideTypingIndicator();
          const reply = "I am MEDHA AI";
          appendMessage("assistant", reply);
          messages.push({ role: "assistant", content: reply });
          return;
        }
        
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "llama3-70b-8192",
            messages: messages
          })
        });
        
        const data = await response.json();
        hideTypingIndicator();
        
        if (data.choices && data.choices[0]) {
          let reply = data.choices[0].message.content;
          
          // For developer questions, use special card
          if (isDeveloperQuestion(userText)) {
            appendMessage("assistant", reply, true);
          } else {
            appendMessage("assistant", reply, false);
          }
          
          messages.push({ role: "assistant", content: reply });
        } else {
          appendMessage("assistant", "⚠️ Error: " + (data.error?.message || "Unknown response"));
        }
      } catch (err) {
        hideTypingIndicator();
        appendMessage("assistant", "⚠️ Network error: " + err.message);
      }
    }
    
    // Initialize the chat
    window.addEventListener('load', function() {
      // You can add an initial welcome message if desired
      // appendMessage("assistant", "Hello! I'm MEDHA AI. How can I help you today?");
    });
  </script>
</body>
</html>
